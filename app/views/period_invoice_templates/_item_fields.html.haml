-#  Copyright (c) 2026, BdP and DPSG. This file is part of
-#  hitobito and licensed under the Affero General Public License version 3
-#  or later. See the COPYING file at the top-level directory or at
-#  https://github.com/hitobito/hitobito.

= f.fields_for :items, (new_record ? item_class.constantize.new : nil), (new_record ? { child_index: "NEW_RECORD" } : nil) do |item_fields|
  .fields{ data: { new_record: new_record } }
    = item_fields.hidden_field(:type, value: item_fields.object.class.name)
    .d-flex.flex-row.gap-2
      = item_fields.input_field :name, placeholder: PeriodInvoiceTemplate::Item.human_attribute_name(:name) + "*", class: "mb-2"
      = item_fields.input_field :unit_cost, name: item_fields.object_name + "[dynamic_cost_parameters][unit_cost]", placeholder: PeriodInvoiceTemplate::Item.human_attribute_name(:unit_cost) + "*", class: "mb-2 text-end", style: "flex-basis: 30%"
    .d-flex.flex-row.gap-2
      = item_fields.input_field :cost_center, placeholder: PeriodInvoiceTemplate::Item.human_attribute_name(:cost_center), class: "mb-2"
      = item_fields.input_field :account, placeholder: PeriodInvoiceTemplate::Item.human_attribute_name(:account), class: "mb-2"
    = render "#{item_fields.object.class.name.underscore}_fields", f: item_fields
    .controls.align-with-form
      = link_to(ta(:remove), "javascript:void(0)", class: "remove_nested_fields", data: { action: "period-invoice-template-form#remove" })
    = item_fields.hidden_field(:_destroy)
    .controls.fields-separation
      %hr
